<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ER Rate Card Simulator</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@300;400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #13131a;
    --surface2: #1c1c28;
    --border: #2a2a3d;
    --accent: #4f6ef7;
    --accent2: #7c3aed;
    --accent-glow: rgba(79,110,247,0.15);
    --green: #10b981;
    --amber: #f59e0b;
    --red: #ef4444;
    --text: #e8e8f0;
    --text-dim: #8888aa;
    --text-dimmer: #55556a;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Background grid */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(79,110,247,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(79,110,247,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  .wrapper { position: relative; z-index: 1; max-width: 1100px; margin: 0 auto; padding: 40px 24px 80px; }

  /* Header */
  header { margin-bottom: 40px; }
  .logo-row { display: flex; align-items: center; gap: 12px; margin-bottom: 6px; }
  .logo-badge {
    width: 36px; height: 36px; border-radius: 8px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    display: flex; align-items: center; justify-content: center;
    font-family: 'Syne', sans-serif; font-weight: 800; font-size: 16px;
  }
  h1 {
    font-family: 'Syne', sans-serif;
    font-size: clamp(22px, 4vw, 32px);
    font-weight: 800;
    letter-spacing: -0.5px;
    background: linear-gradient(90deg, #e8e8f0 0%, #8888cc 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }
  .subtitle { color: var(--text-dim); font-size: 13px; margin-top: 4px; }

  /* Model selector */
  .model-selector { margin-bottom: 32px; }
  .section-label {
    font-family: 'DM Mono', monospace;
    font-size: 10px; letter-spacing: 2px; text-transform: uppercase;
    color: var(--text-dimmer); margin-bottom: 10px;
  }
  .model-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 8px;
  }
  .model-btn {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 12px 14px;
    color: var(--text-dim);
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    font-weight: 500;
    text-align: left;
    transition: all 0.2s;
    line-height: 1.4;
  }
  .model-btn:hover { border-color: var(--accent); color: var(--text); background: var(--accent-glow); }
  .model-btn.active {
    border-color: var(--accent);
    background: var(--accent-glow);
    color: #fff;
    box-shadow: 0 0 0 1px var(--accent), 0 4px 20px rgba(79,110,247,0.2);
  }
  .model-btn .model-tag {
    display: inline-block;
    font-family: 'DM Mono', monospace;
    font-size: 9px; letter-spacing: 1px;
    background: var(--accent2); color: #fff;
    padding: 2px 5px; border-radius: 3px;
    margin-bottom: 5px;
    opacity: 0.8;
  }
  .model-btn.active .model-tag { opacity: 1; }

  /* Main layout */
  .main-layout { display: grid; grid-template-columns: 320px 1fr; gap: 20px; align-items: start; }
  @media (max-width: 780px) { .main-layout { grid-template-columns: 1fr; } }

  /* Panel */
  .panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    overflow: hidden;
  }
  .panel-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    display: flex; align-items: center; gap: 8px;
  }
  .panel-header-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--accent); }
  .panel-title { font-family: 'Syne', sans-serif; font-size: 13px; font-weight: 700; letter-spacing: 0.3px; }
  .panel-body { padding: 20px; }

  /* Form elements */
  .field { margin-bottom: 16px; }
  .field:last-child { margin-bottom: 0; }
  label { display: block; font-size: 11px; color: var(--text-dim); margin-bottom: 6px; font-weight: 500; letter-spacing: 0.3px; }
  input, select {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 13px;
    padding: 9px 12px;
    outline: none;
    transition: border-color 0.2s;
    appearance: none;
  }
  input:focus, select:focus { border-color: var(--accent); }
  input::placeholder { color: var(--text-dimmer); }
  select option { background: var(--surface2); }

  .field-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

  /* Result panel */
  .result-empty {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    padding: 60px 20px; color: var(--text-dimmer); text-align: center; gap: 12px;
  }
  .result-empty svg { opacity: 0.2; }
  .result-empty p { font-size: 12px; line-height: 1.6; }

  /* Rate breakdown */
  .rate-model-name {
    font-family: 'Syne', sans-serif; font-size: 18px; font-weight: 800;
    margin-bottom: 4px;
  }
  .rate-delivery-tag {
    display: inline-flex; align-items: center; gap: 6px;
    background: rgba(16,185,129,0.1); border: 1px solid rgba(16,185,129,0.3);
    color: var(--green); font-family: 'DM Mono', monospace;
    font-size: 10px; letter-spacing: 1px; padding: 3px 8px; border-radius: 4px;
    margin-bottom: 18px;
  }

  .breakdown-table { width: 100%; border-collapse: collapse; margin-bottom: 16px; }
  .breakdown-table tr { border-bottom: 1px solid var(--border); }
  .breakdown-table tr:last-child { border-bottom: none; }
  .breakdown-table td { padding: 9px 0; font-size: 13px; }
  .breakdown-table td:first-child { color: var(--text-dim); }
  .breakdown-table td:last-child { text-align: right; font-family: 'DM Mono', monospace; color: var(--text); }
  .breakdown-table .subtotal td { color: var(--text-dim); font-size: 11px; }
  .breakdown-table .total-row td {
    font-weight: 700; color: var(--accent);
    font-family: 'DM Mono', monospace;
    font-size: 15px; padding-top: 14px;
    border-top: 1px solid var(--accent);
  }
  .breakdown-table .total-row td:first-child { font-family: 'Syne', sans-serif; color: var(--text); font-size: 13px; }

  /* Multi-model result (DS, MCF+DS) */
  .delivery-tabs { display: flex; gap: 6px; margin-bottom: 16px; flex-wrap: wrap; }
  .dtab {
    padding: 6px 14px; border-radius: 6px; font-size: 11px; font-weight: 600;
    cursor: pointer; border: 1px solid var(--border); background: var(--surface2);
    color: var(--text-dim); transition: all 0.15s; font-family: 'DM Mono', monospace;
  }
  .dtab.active { background: var(--accent); border-color: var(--accent); color: #fff; }

  /* T&C */
  .tc-section { margin-top: 20px; }
  .tc-toggle {
    display: flex; align-items: center; justify-content: space-between;
    cursor: pointer; padding: 12px 16px;
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 8px; user-select: none;
    font-size: 12px; font-weight: 600; color: var(--text-dim);
    transition: all 0.2s;
  }
  .tc-toggle:hover { border-color: var(--border); color: var(--text); }
  .tc-arrow { transition: transform 0.2s; font-size: 10px; }
  .tc-arrow.open { transform: rotate(180deg); }
  .tc-body {
    background: var(--surface2); border: 1px solid var(--border);
    border-top: none; border-radius: 0 0 8px 8px;
    padding: 14px 16px; display: none;
  }
  .tc-body.open { display: block; }
  .tc-item {
    display: flex; gap: 8px; padding: 5px 0;
    font-size: 11.5px; color: var(--text-dim); line-height: 1.6;
    border-bottom: 1px solid rgba(255,255,255,0.04);
  }
  .tc-item:last-child { border-bottom: none; }
  .tc-bullet { color: var(--accent); flex-shrink: 0; margin-top: 2px; }

  /* Additional charges badge */
  .addl-charges { margin-top: 16px; }
  .addl-title { font-family: 'DM Mono', monospace; font-size: 10px; letter-spacing: 1.5px; color: var(--text-dimmer); margin-bottom: 8px; text-transform: uppercase; }
  .addl-grid { display: flex; flex-wrap: wrap; gap: 6px; }
  .addl-chip {
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 6px; padding: 5px 10px;
    font-family: 'DM Mono', monospace; font-size: 11px; color: var(--text-dim);
  }
  .addl-chip span { color: var(--amber); }

  /* Zone selector for ROI */
  .zone-pills { display: flex; gap: 6px; flex-wrap: wrap; }
  .zone-pill {
    padding: 5px 12px; border-radius: 20px; font-size: 11px; font-weight: 600;
    cursor: pointer; border: 1px solid var(--border); background: var(--surface2);
    color: var(--text-dim); transition: all 0.15s;
  }
  .zone-pill.active { background: var(--accent2); border-color: var(--accent2); color: #fff; }

  /* Highlight total */
  .total-hero {
    background: linear-gradient(135deg, rgba(79,110,247,0.1), rgba(124,58,237,0.1));
    border: 1px solid rgba(79,110,247,0.3);
    border-radius: 12px; padding: 18px 20px;
    margin-bottom: 16px; display: flex; align-items: center; justify-content: space-between;
  }
  .total-hero-label { font-size: 12px; color: var(--text-dim); margin-bottom: 4px; }
  .total-hero-value { font-family: 'Syne', sans-serif; font-size: 28px; font-weight: 800; color: var(--accent); }
  .total-hero-sub { font-size: 11px; color: var(--text-dimmer); margin-top: 3px; }

  /* Animate in */
  @keyframes fadeUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
  .anim { animation: fadeUp 0.3s ease forwards; }

  .divider { border: none; border-top: 1px solid var(--border); margin: 16px 0; }

  .hint { font-size: 11px; color: var(--text-dimmer); margin-top: 4px; }
  .checkbox-row { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; }
  .checkbox-row input[type=checkbox] { width: auto; }
  .checkbox-row label { margin: 0; color: var(--text-dim); font-size: 12px; }
</style>
</head>
<body>
<div class="wrapper">

  <header>
    <div class="logo-row">
      <div class="logo-badge">ER</div>
      <h1>Rate Card Simulator</h1>
    </div>
    <p class="subtitle">Select a fulfillment model, enter client assumptions, and get an instant rate estimate.</p>
  </header>

  <!-- Model Selector -->
  <div class="model-selector">
    <div class="section-label">Select Fulfillment Model</div>
    <div class="model-grid">
      <button class="model-btn" onclick="selectModel('mcf_fulfillment')">
        <div class="model-tag">MCF</div><br>MCF Only Fulfillment
      </button>
      <button class="model-btn" onclick="selectModel('mcf_delivery')">
        <div class="model-tag">MCF</div><br>MCF Inventory &amp; Delivery
      </button>
      <button class="model-btn" onclick="selectModel('ds_delivery')">
        <div class="model-tag">DS</div><br>DS Inventory &amp; Delivery
      </button>
      <button class="model-btn" onclick="selectModel('mcf_ds')">
        <div class="model-tag">MCF+DS</div><br>MCF + DS Inventory &amp; Delivery
      </button>
      <button class="model-btn" onclick="selectModel('b2b_slotted')">
        <div class="model-tag">B2B</div><br>B2B Slotted Delivery
      </button>
      <button class="model-btn" onclick="selectModel('box_b2b')">
        <div class="model-tag">B2B</div><br>Box in Box Out B2B
      </button>
      <button class="model-btn" onclick="selectModel('roi_delivery')">
        <div class="model-tag">ROI</div><br>ROI Delivery from MCF
      </button>
      <button class="model-btn" onclick="selectModel('rvp')">
        <div class="model-tag">RVP</div><br>Reverse (RVP)
      </button>
    </div>
  </div>

  <!-- Main layout -->
  <div class="main-layout">
    <!-- Left: Inputs -->
    <div class="panel" id="input-panel">
      <div class="panel-header">
        <div class="panel-header-dot"></div>
        <div class="panel-title">Client Assumptions</div>
      </div>
      <div class="panel-body" id="input-body">
        <div class="result-empty">
          <svg width="40" height="40" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
          <p>Select a model above to begin entering client assumptions.</p>
        </div>
      </div>
    </div>

    <!-- Right: Results -->
    <div class="panel" id="result-panel">
      <div class="panel-header">
        <div class="panel-header-dot" style="background:var(--green)"></div>
        <div class="panel-title">Rate Simulation Output</div>
      </div>
      <div class="panel-body" id="result-body">
        <div class="result-empty">
          <svg width="40" height="40" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
          <p>Your rate breakdown will appear here once you select a model and fill in the inputs.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let currentModel = null;
let currentDeliveryTab = 0;
let currentZone = 'regional';
let tcOpen = false;

// ‚îÄ‚îÄ‚îÄ Model Configs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const MODELS = {
  mcf_fulfillment: {
    label: 'MCF Inventory Fulfillment',
    tag: 'MCF',
    weightBands: [
      { label: '0‚Äì0.5 kg', ib: 4.5, ob: 8.5, wt: 0.5 },
      { label: '0.5‚Äì1 kg', ib: 5.5, ob: 10,  wt: 0.75 },
      { label: '1‚Äì2 kg',   ib: 8,   ob: 16,  wt: 1.25 },
      { label: '2‚Äì5 kg',   ib: 13,  ob: 31,  wt: 3.5  },
      { label: '5‚Äì10 kg',  ib: 22,  ob: 58,  wt: 7.5  },
      { label: '10‚Äì20 kg', ib: 42,  ob: 97,  wt: 15   },
    ],
    inputs: ['items_per_order','doh_mcf','weight_band'],
    tc: TC_MCF_FULFILLMENT(),
  },
  mcf_delivery: {
    label: 'MCF Inventory & Delivery',
    tag: 'MCF',
    weightBands: [
      { label: '0‚Äì0.5 kg', ib: 4.5, ob: 8.5, wt: 0.5 },
      { label: '0.5‚Äì1 kg', ib: 5.5, ob: 10,  wt: 0.75 },
      { label: '1‚Äì2 kg',   ib: 8,   ob: 16,  wt: 1.25 },
      { label: '2‚Äì5 kg',   ib: 13,  ob: 31,  wt: 3.5  },
      { label: '5‚Äì10 kg',  ib: 22,  ob: 58,  wt: 7.5  },
      { label: '10‚Äì20 kg', ib: 42,  ob: 97,  wt: 15   },
    ],
    inputs: ['items_per_order','doh_mcf','weight_band','delivery_model_mcf'],
    tc: TC_MCF_DELIVERY(),
  },
  ds_delivery: {
    label: 'DS Inventory & Delivery',
    tag: 'DS',
    inputs: ['avg_weight','items_per_order','doh_ds'],
    tc: TC_DS(),
  },
  mcf_ds: {
    label: 'MCF + DS Inventory & Delivery',
    tag: 'MCF+DS',
    inputs: ['avg_weight','items_per_order','doh_ds','doh_mcf'],
    tc: TC_MCF_DS(),
  },
  b2b_slotted: {
    label: 'B2B Slotted Delivery',
    tag: 'B2B',
    inputs: ['volume_kg','slot_type','ucc','waybill','additional_km','fuel_surcharge'],
    tc: TC_B2B_SLOTTED(),
  },
  box_b2b: {
    label: 'Box in Box Out B2B',
    tag: 'B2B',
    inputs: ['daily_boxes'],
    tc: TC_BOX_B2B(),
  },
  roi_delivery: {
    label: 'ROI Delivery from MCF',
    tag: 'ROI',
    inputs: ['roi_weight','zone','cod_applicable'],
    tc: TC_ROI(),
  },
  rvp: {
    label: 'Reverse (RVP)',
    tag: 'RVP',
    inputs: ['rvp_weight'],
    tc: TC_RVP(),
  },
};

// ‚îÄ‚îÄ‚îÄ T&C Definitions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function TC_MCF_FULFILLMENT() {
  return [
    'The final payable amount shall be determined based on actual quantities applied to the respective cost elements. The blended rate is for estimation only and shall not be the basis for billing.',
    'All packaging materials will be included in inventory counts and stored as part of warehouse stock.',
    'A storage charge of ‚Çπ50/CFT per month will be applicable for inventory held beyond the agreed DOH. Standard rate is ‚Çπ40/CFT.',
    'For inventory loss and damage, a leeway of 0.5% of the average inventory value will be considered.',
    'Packaging material beyond 3 types will attract an additional charge, as per the agreement.',
    'Fragile items will attract an additional VAS charge. Undeclared fragile items will not be covered under loss or damage claims.',
    'Billing shall be based on the higher of actual or volumetric weight.',
    'Restricted or prohibited items are not permitted in the ER network.',
    'Additional sorting, re-segregation, or re-put-away requested by the client shall be chargeable.',
    'Special put-away requirements (zone-wise, batch-wise, or priority storage) shall be treated as a chargeable VAS.',
  ];
}
function TC_MCF_DELIVERY() {
  return [...TC_MCF_FULFILLMENT(),
    'MG for SDD 11 AM: 150 Units. MG for NDD 6 PM: 50 Units.',
    'COD: Rs 20 per order or 1.25% of the order value, whichever is higher.',
    'RTO: 80% of the forward delivery charge.',
  ];
}
function TC_DS() {
  return [
    'The final payable amount shall be determined based on actual quantities. The blended rate is for estimation only.',
    'All packaging materials will be included in inventory counts and stored as part of warehouse stock.',
    'Same rates will be applicable for orders outside the order window as well.',
    'Minimum Guarantee (MG) for 2 Hrs per DS per Day: 30 orders.',
    'A storage charge of ‚Çπ500/CFT will be applicable for inventory held beyond the agreed DOH.',
    'The SNOP logic must be shared by the client; ER will execute the same logic.',
    'For inventory loss and damage, a leeway of 0.5% of the average inventory value will be considered.',
    'All processes from in-warding inventory at DS up to final delivery will be fully managed by ER.',
    'The maximum permissible shipment weight is 7 Kgs.',
    'Packaging material beyond 3 types will attract an additional charge.',
    'Rates are applicable up to 2 kgs. For shipments beyond 2 kgs, an additional T&C surcharge of ‚Çπ12 per 0.5 kg is applicable over and above the delivery charge.',
    'Fragile items will attract an additional VAS charge. Undeclared fragile items not covered under claims.',
    'Billing shall be based on the higher of actual or volumetric weight.',
    'Restricted or prohibited items are not permitted in the ER network.',
    'COD: Rs 20 per order or 1.25% of the order value, whichever is higher.',
    'RTO: 80% of the forward delivery charge.',
    'A variance of up to ¬±15% from forecasted order volumes shall be permitted.',
  ];
}
function TC_MCF_DS() {
  return [...TC_DS(),
    'MCF storage: ‚Çπ40/CFT per month (standard). Penalty: ‚Çπ500/CFT beyond agreed DOH.',
  ];
}
function TC_B2B_SLOTTED() {
  return [
    'The base rate of ‚Çπ10/kg applies only up to 60 kms intra-city. Beyond 60 kms, an additional charge of ‚Çπ50 per km is applicable.',
    'Minimum chargeable weight is 40 kg; minimum charge is ‚Çπ400.',
    'Standard Slot: any 3-hour window (‚Çπ160/waybill). Priority Slot: 1‚Äì2 hour or same-day window (‚Çπ275/waybill).',
    'Urban Congestion Charge (UCC): ‚Çπ250 per delivery ‚Äî applicable in all metro cities.',
    'Waybill/Documentation: ‚Çπ300 per shipment, inclusive of billing & POD documentation.',
    'Fuel Surcharge: 10% of the total delivery cost, adjusted monthly based on crude oil price index.',
    'Detention: First 60 mins free. ‚Çπ200 per hour block from 61st minute onwards.',
    'Slot reschedule (< 12 hrs before): ‚Çπ150. Slot cancellation (< 12 hrs before): ‚Çπ100 (non-refundable).',
  ];
}
function TC_BOX_B2B() {
  return [
    'Box size is estimated at 1.25 CFT. Actual billing will be based on the actual CFT of each box.',
    'The final blended rate is for estimation only and shall not be the basis for billing.',
    'A storage charge of ‚Çπ40/CFT will be applicable for inventory held beyond agreed DOH.',
    'SNOP logic must be shared by the client. Logic for Box-in-Piece-Out and Box-in-Box-Out segregation to be provided by client.',
    'For inventory loss and damage, a leeway of 0.5% of the average inventory value will be considered.',
    'High-value goods will attract an additional handling charge of ‚Çπ8 per box.',
    'Damage/shortage claims must be raised within 7 days. Liability limited to invoice value.',
    'Rates reviewed annually with 60 days notice. Seasonal surcharge of 10‚Äì15% may apply during Oct‚ÄìDec and Jun‚ÄìJul.',
    'A variance of up to ¬±5% from forecasted order volumes shall be permitted.',
    'All rates are exclusive of applicable GST.',
    'Fragile items will attract an additional VAS charge. Undeclared fragile items not covered.',
    'Restricted or prohibited items are not permitted in the ER network.',
  ];
}
function TC_ROI() {
  return [
    'For weight < 2 kg: base rate covers first 500g + additional charge per 500g slab.',
    'For weight ‚â• 2 kg: base rate covers first 2 kg + additional charge per 1 kg slab.',
    'RTO: 90% of the forward delivery charge.',
    'COD: ‚Çπ23 fixed charge or 1.25% of invoice value, whichever is higher.',
    'Fuel Surcharge (FSC): 10% in Month 1 (NA to volume). Steps down to 5% or 0% from Month 2/3 based on volume ramp-up.',
    'Diesel hike mechanism: For every 1% change in diesel price (base ‚Çπ90.5/ltr), freight adjusts by 1%. Negative diesel price hikes are disabled.',
    'Billing shall be based on the higher of actual or volumetric weight.',
    'Restricted or prohibited items are not permitted in the ER network.',
  ];
}
function TC_RVP() {
  return [
    'QC returns will be picked up from the client\'s location and transported to the ER hub.',
    'Quality check will be conducted at the hub where inventory is stored.',
    'Post-QC, material handover/backhaul will be managed by the client.',
    'Rates are exclusive of flyers, stationery, or any packaging material. Consumables will be charged additionally.',
  ];
}

// ‚îÄ‚îÄ‚îÄ Input Templates ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderInputs(model) {
  const m = MODELS[model];
  let html = '';

  if (m.inputs.includes('weight_band')) {
    html += `<div class="field"><label>Weight Category</label><select id="weight_band" onchange="calculate()">
      ${m.weightBands.map((b,i) => `<option value="${i}">${b.label}</option>`).join('')}
    </select></div>`;
  }
  if (m.inputs.includes('avg_weight')) {
    html += `<div class="field"><label>Average Weight per Item (kg)</label>
      <input type="number" id="avg_weight" value="0.5" step="0.1" min="0.1" max="7" onchange="calculate()">
      <div class="hint">Max 7 kg per shipment</div></div>`;
  }
  if (m.inputs.includes('items_per_order')) {
    html += `<div class="field"><label>Number of Items per Order</label>
      <input type="number" id="items_per_order" value="1" min="1" onchange="calculate()"></div>`;
  }
  if (m.inputs.includes('doh_mcf')) {
    html += `<div class="field"><label>Days of Inventory at MCF</label>
      <input type="number" id="doh_mcf" value="30" min="1" onchange="calculate()">
      <div class="hint">Storage penalty (‚Çπ50/CFT) applies beyond agreed DOH</div></div>`;
  }
  if (m.inputs.includes('doh_ds')) {
    html += `<div class="field"><label>Days of Inventory at Dark Store</label>
      <input type="number" id="doh_ds" value="7" min="1" onchange="calculate()"></div>`;
  }
  if (m.inputs.includes('delivery_model_mcf')) {
    html += `<div class="field"><label>Delivery Model</label><select id="delivery_model_mcf" onchange="calculate()">
      <option value="sdd">SDD 11 AM</option>
      <option value="ndd">NDD 6 PM</option>
    </select></div>`;
  }
  if (m.inputs.includes('volume_kg')) {
    html += `<div class="field"><label>Volume / Shipment Weight (kg)</label>
      <input type="number" id="volume_kg" value="20" min="1" onchange="calculate()">
      <div class="hint">Minimum chargeable weight: 40 kg</div></div>`;
  }
  if (m.inputs.includes('slot_type')) {
    html += `<div class="field"><label>Slot Type</label><select id="slot_type" onchange="calculate()">
      <option value="standard">Standard Slot (‚Çπ160)</option>
      <option value="priority">Priority Slot (‚Çπ275)</option>
    </select></div>`;
  }
  if (m.inputs.includes('ucc')) {
    html += `<div class="checkbox-row"><input type="checkbox" id="ucc" onchange="calculate()">
      <label for="ucc">Urban Congestion Charge (UCC) ‚Äî Metro cities ‚Çπ250</label></div>`;
  }
  if (m.inputs.includes('waybill')) {
    html += `<div class="checkbox-row"><input type="checkbox" id="waybill" onchange="calculate()">
      <label for="waybill">Waybill / Documentation ‚Äî ‚Çπ300</label></div>`;
  }
  if (m.inputs.includes('fuel_surcharge')) {
    html += `<div class="checkbox-row"><input type="checkbox" id="fuel_surcharge" onchange="calculate()">
      <label for="fuel_surcharge">Fuel Surcharge ‚Äî 10% on total</label></div>`;
  }
  if (m.inputs.includes('additional_km')) {
    html += `<div class="field"><label>Additional KMs beyond 60 km</label>
      <input type="number" id="additional_km" value="0" min="0" onchange="calculate()"></div>`;
  }
  if (m.inputs.includes('daily_boxes')) {
    html += `<div class="field"><label>Average Outbound Volume per Day (boxes)</label>
      <input type="number" id="daily_boxes" value="50" min="1" onchange="calculate()"></div>`;
  }
  if (m.inputs.includes('roi_weight')) {
    html += `<div class="field"><label>Shipment Weight (kg)</label>
      <input type="number" id="roi_weight" value="0.5" step="0.5" min="0.5" onchange="calculate()"></div>
      <div class="field"><label>Delivery Zone</label>
      <div class="zone-pills">
        <div class="zone-pill active" onclick="setZone('regional',this)">Regional</div>
        <div class="zone-pill" onclick="setZone('metro',this)">Metro to Metro</div>
        <div class="zone-pill" onclick="setZone('roi',this)">Rest of India</div>
        <div class="zone-pill" onclick="setZone('ne',this)">NE / J&K / Kerala</div>
      </div></div>`;
  }
  if (m.inputs.includes('cod_applicable')) {
    html += `<div class="checkbox-row"><input type="checkbox" id="cod_applicable" onchange="calculate()">
      <label for="cod_applicable">COD Applicable</label></div>
      <div class="field" id="cod_value_field" style="display:none"><label>Order Value (‚Çπ) for COD</label>
      <input type="number" id="cod_value" value="500" min="0" onchange="calculate()"></div>`;
  }
  if (m.inputs.includes('rvp_weight')) {
    html += `<div class="field"><label>Return Shipment Weight (kg)</label>
      <select id="rvp_weight" onchange="calculate()">
        <option value="0.5">0.5 kg ‚Äî ‚Çπ70</option>
        <option value="1">1.0 kg ‚Äî ‚Çπ74</option>
        <option value="1.5">1.5 kg ‚Äî ‚Çπ88</option>
        <option value="2">2.0 kg ‚Äî ‚Çπ103</option>
        <option value="2.5">2.5 kg ‚Äî ‚Çπ116</option>
        <option value="3">3.0 kg ‚Äî ‚Çπ139</option>
      </select></div>`;
  }

  return html;
}

// ‚îÄ‚îÄ‚îÄ Calculation Engine ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function ceiling(x, sig) { return Math.ceil(x / sig) * sig; }
function fmt(n) { return '‚Çπ' + Number(n).toFixed(2); }

function calcMCFFulfillment() {
  const items = parseFloat(document.getElementById('items_per_order').value) || 1;
  const doh = parseFloat(document.getElementById('doh_mcf').value) || 30;
  const bandIdx = parseInt(document.getElementById('weight_band').value);
  const m = MODELS.mcf_fulfillment;
  const band = m.weightBands[bandIdx];

  const inbound = band.ib * items;
  const outbound = band.ob * items;
  const storage = (40 / 30) * doh * band.wt * 0.18 * items;
  const total = inbound + outbound + storage;

  return { inbound, outbound, storage, total, band, items, doh };
}

function calcMCFDelivery() {
  const base = calcMCFFulfillment();
  const dm = document.getElementById('delivery_model_mcf').value;
  const deliveryBase = dm === 'sdd' ? 32 : 29;
  const addlPer05 = 18;
  // For MCF delivery, weight band determines slab ‚Äî for weight > 0.5, add per slab
  const wt = base.band.wt;
  let deliveryExcess = 0;
  if (wt > 0.5) {
    deliveryExcess = addlPer05 * ceiling(wt - 0.5, 0.5) / 0.5;
  }
  const delivery = deliveryBase + deliveryExcess;
  const total = base.total + delivery;
  return { ...base, delivery, deliveryBase, deliveryExcess, dm, total };
}

function calcDS(avgWt, items, dohDs) {
  avgWt = avgWt || parseFloat(document.getElementById('avg_weight').value) || 0.5;
  items = items || parseFloat(document.getElementById('items_per_order').value) || 1;
  dohDs = dohDs || parseFloat(document.getElementById('doh_ds').value) || 7;

  const totalWt = avgWt * items;
  const ops = 20 * items;
  const storage = (343 / 30) * 0.18 * dohDs * items * avgWt;

  // Delivery per model
  function deliveryCost(model) {
    let base, threshold;
    if (model === '2hrs') { base = 62; threshold = 2; }
    else if (model === 'sdd') { base = 27; threshold = 0.5; }
    else { base = 24; threshold = 0.5; }
    const excess = totalWt <= threshold ? 0 : 36 * ceiling(totalWt - threshold, 0.5);
    return { base, excess, total: base + excess };
  }

  return {
    ops, storage, avgWt, items, dohDs, totalWt,
    '2hrs': deliveryCost('2hrs'),
    'sdd': deliveryCost('sdd'),
    'ndd': deliveryCost('ndd'),
  };
}

function calcMCFDS() {
  const avgWt = parseFloat(document.getElementById('avg_weight').value) || 0.5;
  const items = parseFloat(document.getElementById('items_per_order').value) || 1;
  const dohDs = parseFloat(document.getElementById('doh_ds').value) || 7;
  const dohMcf = parseFloat(document.getElementById('doh_mcf').value) || 23;

  const ds = calcDS(avgWt, items, dohDs);
  const mcfInbound = 5 * items;
  const mcfOutbound = 9 * items;
  const mcfStorage = (40 / 30) * 0.18 * dohMcf * items * avgWt;

  function total(dm) {
    return ds[dm].total + ds.ops + ds.storage + mcfInbound + mcfOutbound + mcfStorage;
  }

  return { ds, mcfInbound, mcfOutbound, mcfStorage, dohMcf, items, avgWt,
    '2hrs': total('2hrs'), 'sdd': total('sdd'), 'ndd': total('ndd') };
}

function calcB2B() {
  const vol = parseFloat(document.getElementById('volume_kg').value) || 20;
  const slot = document.getElementById('slot_type').value;
  const ucc = document.getElementById('ucc').checked;
  const waybill = document.getElementById('waybill').checked;
  const fsc = document.getElementById('fuel_surcharge').checked;
  const addlKm = parseFloat(document.getElementById('additional_km').value) || 0;

  const baseRate = Math.max(vol * 10, 400);
  const slotCharge = slot === 'priority' ? 275 : 160;
  const uccCharge = ucc ? 250 : 0;
  const waybillCharge = waybill ? 300 : 0;
  const kmCharge = addlKm * 50;
  const subtotal = baseRate + slotCharge + uccCharge + waybillCharge + kmCharge;
  const fscCharge = fsc ? subtotal * 0.1 : 0;
  const total = subtotal + fscCharge;

  return { baseRate, slotCharge, uccCharge, waybillCharge, kmCharge, subtotal, fscCharge, total, vol, slot };
}

function calcBoxB2B() {
  const daily = parseInt(document.getElementById('daily_boxes').value) || 50;
  let ib, ob;
  if (daily >= 50) { ib = 6.75; ob = 17; }
  else if (daily >= 35) { ib = 7; ob = 17.25; }
  else if (daily >= 25) { ib = 7.25; ob = 18.6; }
  else { ib = 7.5; ob = 19.6; }
  const storage = (40 / 30) * 30 * 1.25;
  const total = ib + ob + storage;
  return { ib, ob, storage, total, daily };
}

function calcROI() {
  const wt = parseFloat(document.getElementById('roi_weight').value) || 0.5;
  const zone = currentZone;
  const codApplicable = document.getElementById('cod_applicable').checked;
  const codValueEl = document.getElementById('cod_value');
  const codValue = codApplicable && codValueEl ? parseFloat(codValueEl.value) || 0 : 0;

  const rates = {
    regional:  { b500: 29, addl500: 24, b2kg: 88,  addl1kg: 25 },
    metro:     { b500: 37, addl500: 28, b2kg: 100, addl1kg: 28 },
    roi:       { b500: 39, addl500: 29, b2kg: 110, addl1kg: 30 },
    ne:        { b500: 49, addl500: 30, b2kg: 120, addl1kg: 32 },
  };
  const r = rates[zone];
  let freight, table;

  if (wt >= 2) {
    // Table 2: base 2kg + per 1kg
    const extra1kg = wt > 2 ? Math.ceil(wt - 2) * r.addl1kg : 0;
    freight = r.b2kg + extra1kg;
    table = 2;
  } else {
    // Table 1: base 500g + per 500g
    const extra500 = wt > 0.5 ? ceiling(wt - 0.5, 0.5) / 0.5 * r.addl500 : 0;
    freight = r.b500 + extra500;
    table = 1;
  }

  let cod = 0;
  if (codApplicable) {
    cod = Math.max(23, codValue * 0.0125);
  }

  return { freight, cod, total: freight + cod, wt, zone, table, r, codApplicable };
}

function calcRVP() {
  const wt = parseFloat(document.getElementById('rvp_weight').value);
  const rates = { 0.5: 70, 1: 74, 1.5: 88, 2: 103, 2.5: 116, 3: 139 };
  return { rate: rates[wt], wt };
}

// ‚îÄ‚îÄ‚îÄ Render Results ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderResult() {
  const m = MODELS[currentModel];
  let html = '';

  if (currentModel === 'mcf_fulfillment') {
    const d = calcMCFFulfillment();
    html = `
      <div class="rate-model-name anim">${m.label}</div>
      <div class="rate-delivery-tag">‚óè FULFILLMENT ONLY</div>
      <div class="total-hero anim">
        <div><div class="total-hero-label">Total Fulfillment Cost per Order</div>
        <div class="total-hero-value">${fmt(d.total)}</div>
        <div class="total-hero-sub">${d.band.label} ¬∑ ${d.items} item(s) ¬∑ ${d.doh} DOH</div></div>
      </div>
      <table class="breakdown-table anim">
        <tr><td>Inbound per Item</td><td>${fmt(d.inbound / d.items)} √ó ${d.items}</td></tr>
        <tr><td>Outbound per Item</td><td>${fmt(d.outbound / d.items)} √ó ${d.items}</td></tr>
        <tr><td>Storage (‚Çπ40/CFT √ó ${d.doh} days √ó ${d.band.wt} kg √ó 0.18)</td><td>${fmt(d.storage)}</td></tr>
        <tr class="total-row"><td>Total</td><td>${fmt(d.total)}</td></tr>
      </table>
      ${renderAddlCharges(['barcoding','marketplace','wms'])}
    `;
  }

  else if (currentModel === 'mcf_delivery') {
    const d = calcMCFDelivery();
    const dmLabel = d.dm === 'sdd' ? 'SDD 11 AM' : 'NDD 6 PM';
    html = `
      <div class="rate-model-name anim">${m.label}</div>
      <div class="rate-delivery-tag">‚óè ${dmLabel}</div>
      <div class="total-hero anim">
        <div><div class="total-hero-label">Total Cost per Order</div>
        <div class="total-hero-value">${fmt(d.total)}</div>
        <div class="total-hero-sub">${d.band.label} ¬∑ ${d.items} item(s) ¬∑ ${d.doh} DOH</div></div>
      </div>
      <table class="breakdown-table anim">
        <tr><td>Inbound</td><td>${fmt(d.inbound)}</td></tr>
        <tr><td>Outbound</td><td>${fmt(d.outbound)}</td></tr>
        <tr><td>MCF Storage</td><td>${fmt(d.storage)}</td></tr>
        <tr><td>Delivery Base (${dmLabel})</td><td>${fmt(d.deliveryBase)}</td></tr>
        ${d.deliveryExcess > 0 ? `<tr><td>Excess Weight Delivery</td><td>${fmt(d.deliveryExcess)}</td></tr>` : ''}
        <tr class="total-row"><td>Total</td><td>${fmt(d.total)}</td></tr>
      </table>
      ${renderAddlCharges(['barcoding','marketplace','wms','cod','rto'])}
    `;
  }

  else if (currentModel === 'ds_delivery') {
    const d = calcDS();
    const tabs = ['2hrs','sdd','ndd'];
    const tabLabels = {'2hrs':'2 Hrs','sdd':'SDD 3 PM','ndd':'NDD 6 PM'};
    const tab = tabs[currentDeliveryTab] || '2hrs';
    const td = d[tab];
    const grandTotal = td.total + d.ops + d.storage;
    html = `
      <div class="rate-model-name anim">${m.label}</div>
      <div class="delivery-tabs anim">
        ${tabs.map((t,i) => `<div class="dtab ${i===currentDeliveryTab?'active':''}" onclick="switchTab(${i})">${tabLabels[t]}</div>`).join('')}
      </div>
      <div class="total-hero anim">
        <div><div class="total-hero-label">Total Cost per Order ¬∑ ${tabLabels[tab]}</div>
        <div class="total-hero-value">${fmt(grandTotal)}</div>
        <div class="total-hero-sub">${d.totalWt} kg ¬∑ ${d.items} item(s) ¬∑ ${d.dohDs} DOH</div></div>
      </div>
      <table class="breakdown-table anim">
        <tr><td>Delivery Base</td><td>${fmt(td.base)}</td></tr>
        ${td.excess > 0 ? `<tr><td>Excess Weight Delivery (‚Çπ18/0.5kg)</td><td>${fmt(td.excess)}</td></tr>` : ''}
        <tr><td>DS Inhouse Operations</td><td>${fmt(d.ops)}</td></tr>
        <tr><td>DS Storage (‚Çπ343/CFT √ó ${d.dohDs} days)</td><td>${fmt(d.storage)}</td></tr>
        <tr class="total-row"><td>Total</td><td>${fmt(grandTotal)}</td></tr>
      </table>
      ${renderAddlCharges(['barcoding','marketplace','wms','cod','rto','ds_surcharge'])}
    `;
  }

  else if (currentModel === 'mcf_ds') {
    const d = calcMCFDS();
    const tabs = ['2hrs','sdd','ndd'];
    const tabLabels = {'2hrs':'2 Hrs','sdd':'SDD 3 PM','ndd':'NDD 6 PM'};
    const tab = tabs[currentDeliveryTab] || '2hrs';
    const td = d.ds[tab];
    const grandTotal = d[tab];
    html = `
      <div class="rate-model-name anim">${m.label}</div>
      <div class="delivery-tabs anim">
        ${tabs.map((t,i) => `<div class="dtab ${i===currentDeliveryTab?'active':''}" onclick="switchTab(${i})">${tabLabels[t]}</div>`).join('')}
      </div>
      <div class="total-hero anim">
        <div><div class="total-hero-label">Total Cost per Order ¬∑ ${tabLabels[tab]}</div>
        <div class="total-hero-value">${fmt(grandTotal)}</div>
        <div class="total-hero-sub">${d.avgWt} kg/item ¬∑ ${d.items} item(s)</div></div>
      </div>
      <table class="breakdown-table anim">
        <tr><td colspan="2" style="color:var(--text-dimmer);font-size:10px;letter-spacing:1px;padding-bottom:4px">MCF LAYER</td></tr>
        <tr><td>MCF Inbound (‚Çπ5/item)</td><td>${fmt(d.mcfInbound)}</td></tr>
        <tr><td>MCF Outbound + Middle Mile (‚Çπ9/item)</td><td>${fmt(d.mcfOutbound)}</td></tr>
        <tr><td>MCF Storage (‚Çπ40/CFT √ó ${d.dohMcf} days)</td><td>${fmt(d.mcfStorage)}</td></tr>
        <tr><td colspan="2" style="color:var(--text-dimmer);font-size:10px;letter-spacing:1px;padding:8px 0 4px">DS LAYER</td></tr>
        <tr><td>DS Inhouse Operations</td><td>${fmt(d.ds.ops)}</td></tr>
        <tr><td>DS Storage (‚Çπ343/CFT √ó ${d.ds.dohDs} days)</td><td>${fmt(d.ds.storage)}</td></tr>
        <tr><td>Delivery Base</td><td>${fmt(td.base)}</td></tr>
        ${td.excess > 0 ? `<tr><td>Excess Weight Delivery</td><td>${fmt(td.excess)}</td></tr>` : ''}
        <tr class="total-row"><td>Total</td><td>${fmt(grandTotal)}</td></tr>
      </table>
      ${renderAddlCharges(['barcoding','marketplace','wms','refrigeration','cod','rto'])}
    `;
  }

  else if (currentModel === 'b2b_slotted') {
    const d = calcB2B();
    html = `
      <div class="rate-model-name anim">${m.label}</div>
      <div class="rate-delivery-tag">‚óè ${d.slot === 'priority' ? 'PRIORITY SLOT' : 'STANDARD SLOT'}</div>
      <div class="total-hero anim">
        <div><div class="total-hero-label">Total Delivery Cost</div>
        <div class="total-hero-value">${fmt(d.total)}</div>
        <div class="total-hero-sub">${d.vol} kg shipment</div></div>
      </div>
      <table class="breakdown-table anim">
        <tr><td>Base Rate (‚Çπ10/kg, min ‚Çπ400)</td><td>${fmt(d.baseRate)}</td></tr>
        <tr><td>Slot Charge</td><td>${fmt(d.slotCharge)}</td></tr>
        ${d.uccCharge > 0 ? `<tr><td>Urban Congestion Charge</td><td>${fmt(d.uccCharge)}</td></tr>` : ''}
        ${d.waybillCharge > 0 ? `<tr><td>Waybill / Documentation</td><td>${fmt(d.waybillCharge)}</td></tr>` : ''}
        ${d.kmCharge > 0 ? `<tr><td>Additional KM Charges</td><td>${fmt(d.kmCharge)}</td></tr>` : ''}
        ${d.fscCharge > 0 ? `<tr><td>Fuel Surcharge (10%)</td><td>${fmt(d.fscCharge)}</td></tr>` : ''}
        <tr class="total-row"><td>Total</td><td>${fmt(d.total)}</td></tr>
      </table>
    `;
  }

  else if (currentModel === 'box_b2b') {
    const d = calcBoxB2B();
    const tier = d.daily >= 50 ? '‚â• 50 boxes/day' : d.daily >= 35 ? '35‚Äì49 boxes/day' : d.daily >= 25 ? '25‚Äì34 boxes/day' : '< 25 boxes/day (MG Applicable)';
    html = `
      <div class="rate-model-name anim">${m.label}</div>
      <div class="rate-delivery-tag">‚óè ${tier.toUpperCase()}</div>
      <div class="total-hero anim">
        <div><div class="total-hero-label">Final Rate per Box</div>
        <div class="total-hero-value">${fmt(d.total)}</div>
        <div class="total-hero-sub">Box size: 1.25 CFT ¬∑ 30 DOH</div></div>
      </div>
      <table class="breakdown-table anim">
        <tr><td>Inbound per Box</td><td>${fmt(d.ib)}</td></tr>
        <tr><td>Outbound per Box</td><td>${fmt(d.ob)}</td></tr>
        <tr><td>Storage (‚Çπ40/CFT √ó 1.25 CFT √ó 30 days)</td><td>${fmt(d.storage)}</td></tr>
        <tr class="total-row"><td>Total per Box</td><td>${fmt(d.total)}</td></tr>
      </table>
      ${renderAddlCharges(['high_value'])}
    `;
  }

  else if (currentModel === 'roi_delivery') {
    const d = calcROI();
    const zoneLabel = { regional: 'Regional', metro: 'Metro to Metro', roi: 'Rest of India', ne: 'NE / J&K / Kerala' }[d.zone];
    html = `
      <div class="rate-model-name anim">${m.label}</div>
      <div class="rate-delivery-tag">‚óè ${zoneLabel.toUpperCase()} ¬∑ TABLE ${d.table}</div>
      <div class="total-hero anim">
        <div><div class="total-hero-label">Total Delivery Cost</div>
        <div class="total-hero-value">${fmt(d.total)}</div>
        <div class="total-hero-sub">${d.wt} kg ¬∑ ${zoneLabel}</div></div>
      </div>
      <table class="breakdown-table anim">
        <tr><td>Base Freight</td><td>${fmt(d.freight)}</td></tr>
        ${d.cod > 0 ? `<tr><td>COD Charge</td><td>${fmt(d.cod)}</td></tr>` : ''}
        <tr class="total-row"><td>Total</td><td>${fmt(d.total)}</td></tr>
      </table>
      ${renderAddlCharges(['roi_rto','roi_fsc'])}
    `;
  }

  else if (currentModel === 'rvp') {
    const d = calcRVP();
    html = `
      <div class="rate-model-name anim">${m.label}</div>
      <div class="rate-delivery-tag">‚óè INTRACITY CONNECT</div>
      <div class="total-hero anim">
        <div><div class="total-hero-label">Return Pickup Rate</div>
        <div class="total-hero-value">${fmt(d.rate)}</div>
        <div class="total-hero-sub">${d.wt} kg shipment</div></div>
      </div>
      <table class="breakdown-table anim">
        <tr><td>Intracity Connect Rate</td><td>${fmt(d.rate)}</td></tr>
        <tr class="total-row"><td>Total</td><td>${fmt(d.rate)}</td></tr>
      </table>
      ${renderAddlCharges(['rvp_consumables'])}
    `;
  }

  // T&C
  html += renderTC(m.tc);

  document.getElementById('result-body').innerHTML = html;
}

function renderAddlCharges(types) {
  const chips = {
    barcoding: ['Barcoding & Labelling', '‚Çπ1.5/order'],
    marketplace: ['Marketplace Integration', '‚Çπ1.6/order'],
    wms: ['WMS', '‚Çπ1.2/order'],
    cod: ['COD', 'Max(‚Çπ20, 1.25%)'],
    rto: ['RTO', '80% of Forward'],
    refrigeration: ['Refrigeration', '‚Çπ0.3/item'],
    ds_surcharge: ['Weight Surcharge >2kg', '‚Çπ12/0.5kg (billing)'],
    high_value: ['High-Value Goods', '‚Çπ8/box'],
    roi_rto: ['RTO', '90% of Forward'],
    roi_fsc: ['Fuel Surcharge', '10% (Month 1)'],
    rvp_consumables: ['Packaging/Consumables', 'Charged extra'],
  };
  const selected = types.filter(t => chips[t]);
  if (!selected.length) return '';
  return `
    <div class="addl-charges anim">
      <div class="addl-title">Additional Charges (if applicable)</div>
      <div class="addl-grid">
        ${selected.map(t => `<div class="addl-chip">${chips[t][0]} ‚Äî <span>${chips[t][1]}</span></div>`).join('')}
      </div>
    </div>`;
}

function renderTC(items) {
  return `
    <div class="tc-section anim">
      <div class="tc-toggle" onclick="toggleTC(this)">
        <span>üìã Terms & Conditions</span>
        <span class="tc-arrow">‚ñº</span>
      </div>
      <div class="tc-body">
        ${items.map(t => `<div class="tc-item"><span class="tc-bullet">‚Ä∫</span><span>${t}</span></div>`).join('')}
      </div>
    </div>`;
}

// ‚îÄ‚îÄ‚îÄ UI Controls ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function selectModel(model) {
  currentModel = model;
  currentDeliveryTab = 0;
  currentZone = 'regional';

  // Update button states
  document.querySelectorAll('.model-btn').forEach((b,i) => b.classList.remove('active'));
  event.currentTarget.classList.add('active');

  // Render inputs
  document.getElementById('input-body').innerHTML = renderInputs(model);

  // Initial calc
  calculate();
}

function calculate() {
  if (!currentModel) return;

  // Show/hide COD value field
  const codCb = document.getElementById('cod_applicable');
  const codField = document.getElementById('cod_value_field');
  if (codCb && codField) {
    codField.style.display = codCb.checked ? 'block' : 'none';
  }

  renderResult();
}

function switchTab(idx) {
  currentDeliveryTab = idx;
  calculate();
}

function setZone(zone, el) {
  currentZone = zone;
  document.querySelectorAll('.zone-pill').forEach(p => p.classList.remove('active'));
  el.classList.add('active');
  calculate();
}

function toggleTC(el) {
  const body = el.nextElementSibling;
  const arrow = el.querySelector('.tc-arrow');
  body.classList.toggle('open');
  arrow.classList.toggle('open');
}
</script>
<!-- FLOATING FAQ CHAT BUBBLE -->

<style>
#chat-toggle {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: linear-gradient(135deg,#4f6ef7,#7c3aed);
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 26px;
  cursor: pointer;
  box-shadow: 0 8px 25px rgba(0,0,0,0.4);
  z-index: 99999;
}

#chat-box {
  position: fixed;
  bottom: 95px;
  right: 20px;
  width: 340px;
  height: 450px;
  background: #13131a;
  border: 1px solid #2a2a3d;
  border-radius: 16px;
  display: none;
  flex-direction: column;
  overflow: hidden;
  font-family: 'DM Sans', sans-serif;
  z-index: 99999;
}

#chat-header {
  background: linear-gradient(135deg,#4f6ef7,#7c3aed);
  padding: 14px;
  color: white;
  font-weight: 600;
  font-size: 13px;
}

#chat-messages {
  flex: 1;
  padding: 12px;
  overflow-y: auto;
  font-size: 12px;
}

#chat-input-area {
  display: flex;
  border-top: 1px solid #2a2a3d;
}

#chat-input {
  flex: 1;
  padding: 10px;
  background: #1c1c28;
  border: none;
  color: white;
  font-size: 12px;
}

#chat-send {
  background: #4f6ef7;
  border: none;
  color: white;
  padding: 10px 14px;
  cursor: pointer;
}

.user-msg { margin-bottom: 8px; }
.bot-msg { margin-bottom: 12px; color: #10b981; }
</style>

<div id="chat-toggle">üí¨</div>

<div id="chat-box">
  <div id="chat-header">ER FAQ Assistant</div>
  <div id="chat-messages"></div>
  <div id="chat-input-area">
    <input id="chat-input" placeholder="Ask about MCF, DS, ROI, COD..." />
    <button id="chat-send">Send</button>
  </div>
</div>

<script>
const FAQ = [
  { keys:["mcf"], answer:"MCF is centralized fulfillment including inbound, storage and outbound. Suitable for longer DOH." },
  { keys:["ds","dark store"], answer:"Dark Store enables hyperlocal fulfillment with 2hr, SDD and NDD delivery options." },
  { keys:["roi"], answer:"ROI delivery uses zone-based pricing: Regional, Metro, Rest of India and NE categories." },
  { keys:["cod"], answer:"COD is charged either as fixed amount or % of invoice value depending on the model." },
  { keys:["rto"], answer:"RTO is charged as a % of forward freight (usually 80% or 90% depending on model)." },
  { keys:["storage","doh"], answer:"Storage cost depends on DOH and CFT logic. Penalty rates apply beyond agreed DOH." },
  { keys:["weight","slab"], answer:"Delivery increases based on weight slabs (500g or 1kg increments depending on model)." },
  { keys:["b2b"], answer:"B2B includes Slotted Delivery and Box-in Box-out with volume-based pricing tiers." },
  { keys:["rvp","reverse"], answer:"RVP handles return pickups, QC at hub, and client-managed post-QC material movement." }
];

function findAnswer(msg){
  msg = msg.toLowerCase();
  for(let item of FAQ){
    for(let key of item.keys){
      if(msg.includes(key)){
        return item.answer;
      }
    }
  }
  return "Please refer to the simulator‚Äôs Terms & Conditions or contact ER team for detailed clarification.";
}

document.getElementById("chat-toggle").onclick = function(){
  const box = document.getElementById("chat-box");
  box.style.display = box.style.display === "flex" ? "none" : "flex";
};

document.getElementById("chat-send").onclick = function(){
  const input = document.getElementById("chat-input");
  const msg = input.value;
  if(!msg) return;

  const container = document.getElementById("chat-messages");
  container.innerHTML += `<div class="user-msg"><b>You:</b> ${msg}</div>`;
  const reply = findAnswer(msg);
  container.innerHTML += `<div class="bot-msg"><b>ER:</b> ${reply}</div>`;
  input.value="";
  container.scrollTop = container.scrollHeight;
};
</script>
</body>
</html>
